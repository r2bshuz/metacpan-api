---
name: Docker build

on:
    - push

jobs:
    docker:
        runs-on: ubuntu-latest
        name: build and test
        steps:
            - uses: actions/checkout@v1
            - name: docker build
              run: docker build . --build-arg CPM_ARGS='--with-test' -t api
            - name: run Perl tests
              run: docker run -i api carton exec prove -lr t
              env:
                  ES_TEST: "localhost:9200"
                  METACPAN_SERVER_CONFIG_LOCAL_SUFFIX: testing
